# 负载均衡
##  Ribbon
- 使用Ribbon实现客户端负载均衡的消费者
  - pom.xml
    ```
    <parent>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-parent</artifactId>
        <version>Brixton.BUILD-SNAPSHOT</version>
        <relativePath/>
        <!-- lookup parent from repository -->
    </parent>

    <dependencies>
     <dependency>
       <groupId>org.springframework.cloud</groupId>
       <artifactId>spring-cloud-starter-eureka-server</artifactId>
     </dependency>
     <dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-ribbon</artifactId>
		</dependency>
   </dependencies>
    ```
  - ConsumerController，实现对Service`/add`的请求。

    ```
    @RestController
    public class ConsumerController {
        @Autowired
        RestTemplate restTemplate;
        @RequestMapping(value = "/add", method = RequestMethod.GET)
        public String add() {
            return restTemplate.getForEntity("http://USER-SERVICE/add?name=xu", String.class).getBody();
        }
    }
    ```
  - 注解

    通过`@EnableDiscoveryClient`注解来添加发现服务能力。创建`RestTemplate`实例，并通过`@LoadBalanced`注解开启均衡负载能力。
  - 配置

    配置eureka服务注册中心

    `bootstrap.yml`
    ```
    spring:
      application:
        name: ribbon-consumer
    ```
    `application.yml`
    ```
    server:
      port: 3333

    eureka:
      client:
        serviceUrl:
          defaultZone: http://localhost:8761/eureka/
      instance:
        preferIpAddress: true
    ```
  - 启动

    先启动服务注册中心euraka，本项目中的`discovery-microservice`.
    再分别启动服务提供方：本项目中的`user-service`.修改接口再启动一台`user-service`.
    在euraka里面可以看到启动了两个服务。

    然后启动客户端，本项目中的`web-client-ribbon`.

    访问两次：`http://localhost:3333/add`。查看两台服务提供方日志，可以看到分别被调用了一次。
    这就是Ribbon在客户端实现的对服务调用的负载均衡。
## Feign
